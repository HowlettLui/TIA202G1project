<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>文章/新聞_管理</title>
    <link
      rel="canonical"
      href="https://getbootstrap.com/docs/5.3/examples/headers/"
    />
    <link
      rel="canonical"
      href="https://getbootstrap.com/docs/5.3/examples/footers/"
    />

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"
    />

    <link rel="stylesheet" href="../css/bootstrap.min.css" />
    <link rel="stylesheet" href="../css/headers.css" />

    <style>
      /* S Start */
      div.newsadd {
        width: 85.3%;
        margin: 20px auto;
      }

      div.newsaddcontainer {
        width: 85.3%;
        margin: 20px auto;
      }
      div.newsaddbt button {
        align-items: flex-end;
      }
      .img-container {
        width: 200px;
        height: 200px; /* 設定容器高度 */
        overflow: hidden;
        cursor: pointer;
      }
      .img-container img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      /* S end */
    </style>
  </head>

  <body>
    <!-- 導入共用 header -->
    <div class="headerPage"></div>

    <!-- 開發畫面 -->
    <main>
      <div class="newsadd">
        <span>文章/新聞</span>
        <br />
        <button onclick="location.href='news_fadd.html';">新增</button>
      </div>

      <div class="newsaddcontainer" id="userarticlelist"></div>
    </main>

    <!-- 導入共用 footer -->
    <div class="footerPage"></div>
    <script src="../jquery/jquery-3.7.1.min.js"></script>
    <script>
      $(".headerPage").load("../layout/header.html");
      $(".footerPage").load("../layout/footer.html");
    </script>

    <script src="../js/bootstrap.bundle.min.js"></script>
    <script
      src="https://kit.fontawesome.com/799bf36dfe.js"
      crossorigin="anonymous"
    ></script>
    <script>
      $(document).ready(function () {
        RefeshDaTa();
      });

      function RefeshDaTa() {
        $.ajax({
          url: "/NGFW/articleumgr",
          method: "GET",
          dataType: "json",
          success: function (articles) {
            let tableBody = $("#userarticlelist");
            tableBody.empty();
            articles.forEach((article) => {
              var tmpstatus = "";
              var editdisable = "disabled";
              switch (article.status) {
                case "0":
                  tmpstatus = "編輯中";
                  editdisable = "";
                  break;
                case "1":
                  tmpstatus = "已上架";
                  break;
                case "2":
                  tmpstatus = "待審核";
                  break;
                case "3":
                  tmpstatus = "已退回";
                  editdisable = "";
                  break;
              }

              let row = `<div class="col">
                <div
                  class="row g-0 border rounded overflow-hidden flex-md-row mb-4 shadow-sm h-md-250 position-relative"
                >
                  <div class="img-container">
                    <img
                     src="${article.newsPhoto}"
                     onclick="location.href='/NGFW/newsf/news_fbodyreview.html?articleId=${article.articleId}'"
                    > 
                    </img>
                  </div>
                  <div class="col p-4 flex-column">
                    <strong class="d-inline-block mb-2 text-primary-emphasis text-truncate"
                      >${article.mainTitle}</strong
                    >
                    <p>${article.publishDate} 發佈</p>
                    <p class="card-text text-truncate">
                      ${article.subTitle}
                    </p>
                    <div class="newsaddbt" style="position: absolute; bottom: 5px">
                      <button onclick="location.href='/NGFW/newsf/news_fbodyreview.html?articleId=${article.articleId}'">預覽</button>
                      <button ${editdisable} onclick="location.href='/NGFW/newsf/news_fedit.html?articleId=${article.articleId}'">編輯</button>
                      <button ${editdisable} onclick="DeleteDaTa('${article.articleId}');">刪除</button>
                      <div class="status">狀態：${tmpstatus}</div>
                    </div>
                  </div>
                </div>
            </div>`;
              tableBody.append(row);
            });
          },
          error: function (xhr, status, error) {
            console.error("Error fetching data:", error);
          },
        });
      }

      function DeleteDaTa(articleId) {
        $.ajax({
          url: "/NGFW/articleumgrdel?articleId=" + articleId,
          method: "GET",
          dataType: "json",
          success: function (del_result) {
            RefeshDaTa();
          },
          error: function (xhr, status, error) {
            console.error("Error fetching data:", error);
          },
        });
      }
    </script>
  </body>
</html>
